```
// app.js 文件
"onReachBottomDistance": 50 // 下拉触底距离 50 为 50像素触发
"backgroundColor": "#efefef",  // 下拉刷新窗口颜色
"backgroundTextStyle": "dark" // 下拉刷新窗口圆点样式
"enablePullDownRefresh": true // 开启下拉刷新

// 文件名.js 文件
wx.stopPullDownRefresh()  // 关闭下拉动画
```

```
// 自定义组件
组件名称.js
options: {
	// 组件内的样式不会影响外界样式，外界样式也不会影响组件样式 (默认)
    styleIsolation: "isolated" 
    // 外界样式可以影响到组件样式，组件样式不会影响到外界样式
    styleIsolation: "apply-shared"
    // 组件内的样式也会影响外界样式
    styleIsolation: "shared",
    // ------------------------
    // 不用显示在页面上的字段，只用于逻辑的处理
    // 纯数字字段 为正则表达式 符合这个正则的字段将会被定义为纯数字字段
    pureDataPattern: /^_/
},
 // 数据监听器
 observers: {
    num:function(newVal) {
      console.log(newVal)
    },
 // 通配符 ** 监听对象所有对象的属性变化
 "rgb,**": function(obj) {
   console.log(obj)
 }
},
// 组件的生命周期
  created() {},  // 组件实例刚刚被创建时执行
  attached() {}, // 组件实例在进入页面节点树时执行
  ready() {}, // 组件在视图布局完成后执行
  moved() {}, // 组件实例被移动到另一个节点树执行
  detached() {}, // 组件在被页面移除时执行
  error() {}, // 组件方法抛出异常时执行
  
  // 使用lifetimes定义生命周期函数（级别更高）
  lifetimes: {
    created() {
      console.log('created--')
    },  // 组件实例刚刚被创建时执行
    attached() {
      console.log('attached--')
    }, // 组件实例在进入页面节点树时执行
    ready() {
      console.log('ready--')
    }, // 组件在视图布局完成后执行
  },
```

### 组件之间的数据通信

### tabBar 的六个部分

1. backgroundColor: tabBar 的背景色
2. selectedlconPath:  选中的图片路径
3. borderStyle:  tabBar 上边框的颜色
4. iconPath: 未选时的图片路径
5. selectedColor: tabBar 上文字选中时的效果
6. color: tabBar 未选中的文字颜色

### 配置 request 合法域名

#### 配置步骤：

1. 登入微信小程序管理后台
2. 开发
3. 开发设置
4. 服务器域名
5. 修改 request 合法域名

#### 注意事项：

1. 域名只支持 https 协议
2. 域名不能使用 ip地址或者 localhost
3. 域名必须经过 ICP备案
4. 服务器域名一个月内最多可以申请5次修改

### 页面跳转

```
// navigate 跳转到非tabBar 页面
<navigator url="/pages/user/user" open-type="navigate">跳转详情页</navigator>
// switchTab 跳转到 tabBar 页面
<navigator url="/pages/index/index" open-type="switchTab">跳转首页</navigator>
// 后退一个页面 delta 表示后退的层级
<navigator open-type="navigateBack" delta="1">后退</navigator>
```

#### 编程式导航

```
// 指向 tabBar 页面
wx.switchTab({
   url: '/pages/index/index',
 })
 // 指向非 tabBar 页面
wx.navigateTo({
      url: '/pages/user/user',
      success: (res) => {
        console.log(res)
      } 

    })
   // 接收导航参数
  onLoad(options) {
    // 接收导航参数
    console.log(options)
  },
```

### 页面事件

```
//下拉刷新
// 全局开启 app.json
"enablePullDownRefresh": true
// j开启 app.json
"enablePullDownRefresh": true
```

### 小程序的生命周期函数 

只能在app.js文件中触发

1. onlaunch: function(options) {} // 小程序初始化完成时触发
2. onshow: function(options) {} // 小程序从后台进入前台时触发
3. onhide: function() {}  // 小程序从前台进入后台时触发

### 页面生命周期函数

1. onLoad: function() {}  // 页面加载
2. onShow: function() {} // 监听页面显示
3. onReady: function() {} // 监听页面初次渲染完成，一个页面只能调用一次
4. onHide: function() {} // 监听页面隐藏
5. onUnload: function() {} // 监听页面卸载，一个页面只能调用一次

### wxs 语法的使用

```
<view>{{m1.toUpper(username)}}</view>
<view>{{m2.toLower(username1)}}</view>
<!-- wxs 的使用 -->
<wxs module="m1">
  module.exports.toUpper = function(str) {
    return str.toUpperCase()
  }
</wxs>
<wxs module="m2" src="/utils/module.wxs"></wxs>
```

### 组件之间传递参数

1. 在父组件自定义事件  syncCount(e) {}
2. 在子组件标签上绑定自定义事件 <myTest1 bind:sync="syncCount">
3. 在子组之间定义传递事件  addCount() {}
4. 子组件传递事件中发送数据 this.triggerEvent("sync", {value: this.properties.count})
5. 父组件自定义事件 接收参数 console.log(e.detail.value)

### 获取组件实例

```
// 在组件中定义一个类
<myTest1 bind:sync="syncCount" class="test2">
  <view slot="one">插槽使用1</view>
  <view slot="two">插槽使用2</view>
</myTest1>
// 在父组件.js文件中获取该组件的实例
getChild() {
    // test2
    const child = this.selectComponent(".test2")
    console.log(child)
    // 子组件的 count 加1
    child.setData({
      count: child.properties.count + 1
    })
  }
```

### 自定义组件 behaviors

1. 每个 behavior 可以包含一组属性、数据、生命周期函数和方法。组件引用它时，它的属性、数据和方法会被合并到组件中
2. 每个组件可以引用多个 behavior，behavior 也可以引用其它 behavior。

![study1](C:\Users\蔡怀彬\Pictures\Feedback\{5C513A12-B916-4D43-BC9E-3875361E1C0A}\study1.png)

### 自定义css变量

在app.wxss 中定义全局变量

```css
page {
  --mainColor: #f00;
}
// 使用变量
.mainBox {
  background-color: var(--mainColor);
}
```

在页面.wxss 中定义局部变量

```css
page {
  --mainColor: #c00000;
}
```

### 实现api的Promise

```js
import {promisifyAll} from 'miniprogram-api-promise'
const wxp = wx.p = {}
// 将wx上的所有异步对象挂载到wxp的Promise上
promisifyAll(wx, wxp)
// 使用
async getInfo() {
    const res = await wx.p.request({
      url: 'http://127.0.0.1/api/getViewImage',
      data: {
        page: 2,
        size: 20
      },
      enableCache: true,
      enableHttp2: true,
      enableQuic: true,
      header: {
        Authorization: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEsInVzZXJOYW1lIjoiQ2FpLUh1YWlCaW4iLCJwYXNzd29yZCI6IiIsInVzZXJfcGljIjoiIiwidXNlcl9zaWduYXR1cmUiOiLllK_mnInokL3lj7bnn6Xnp4vmhI8iLCJhY2NvdW50TnVtYmVyIjoiY2hiMTIzIiwiaWF0IjoxNjg2NjIxNTYzLCJleHAiOjE2ODY3MDc5NjN9.C0gccRLTghrdB3SzsuFTEBfX77Vzv2z4S1oyYwdi3Vg"
      }
    })
    console.log(res)
  },
```

### 全局数据共享

安装包

```
npm install mobx-miniprogram@4.13.2 mobx-miniprogram-bindings@1.2.1
```

创建 Store 实例对象

```js
import {action, observable} from 'mobx-miniprogram'
// 创建 Store 对象
export const store = observable({
  numA: 1,
  numB: 2,
  // 计算属性
  get Sum() {
    return this.numA + this.numB
  },
  // 修改store 中定义的值
  updateNum1:action(function(step) {
    this.numA = step
  }),
  updateNum2:action(function(step) {
    this.numB = step
  })
})
```

将 Store 绑定到 页面中

```js
// index.js
import {createStoreBindings} from 'mobx-miniprogram-bindings'
import { store } from '../../Store/Store'
// 挂载页面实例
onLoad() {
  this.storeBindings = createStoreBindings(this, {
    store,
    fields: ["numA", "numB", "getSum"],  // 挂载的参数
    actions: ["updateNum1"]  // 挂载的方法
  })
},
 // 卸载页面实例
 onUnload: function() {
  this.storeBindings.destroyStoreBindings()
},
```

将store绑定到组件中

```js
import {storeBindingsBehavior} from 'mobx-miniprogram-bindings'
import { store } from '../../Store/Store'
Component({
  behaviors: [storeBindingsBehavior],
  storeBindings: {
    store,
    fields: {
      numA: () => store.numA,  // 接收变量的第一种方法
      numB: (store) => store.numB, // 接收变量的第二种方法
      sum: "Sum" // 接收变量的第三种方法
    },
    actions: {
      updateNum1: "updateNum1"
    }
  }
   // 调用store内的方法
    methods: {
    btn(e) {
      this.updateNum1(10)
    }
  }
  })
```

### 小程序分包

```json
{
  "pages":[ // tabBar 页面必须在主包里面
    "pages/index/index",
    "pages/info/info",
    "pages/user/user"
  ],
    // 所有分包必须放在"subPackages"中
  "subPackages": [
    {
      "root": "pkgA", 
      "name": "pkgA",
      "pages": [
        "pages/cat/cat",
        "pages/dog/dog"
      ]
    },{
      "root": "pkgB",
      "name": "pakB",
      "pages": [
        "pages/apple/apple"
      ],
      "independent": true  // 将普通分包改成独立分包
    }
  ],
    "preloadRule": { // 预下载代码
    "pages/user/user": { // 触发下载的页面
      "network": "all", // all 表示不限网络，wifi表示在（自能在wifih）
      "packages": ["pkgA"]  // 可能需要使用的分包 pkgA表示root或name 下载的分包
    }
  },
  "window":{
    "backgroundTextStyle":"light",
    "navigationBarBackgroundColor": "#fff",
    "navigationBarTitleText": "Weixin",
    "navigationBarTextStyle":"black"
  },
  "tabBar": {
    "list": [{
      "pagePath": "pages/index/index",
      "text": "首页",
      "iconPath": "images/tabbarIcon/home2.png",
      "selectedIconPath": "images/tabbarIcon/home1.png"
    },{
      "pagePath": "pages/info/info",
      "text": "信息",
      "iconPath": "images/tabbarIcon/info2.png",
      "selectedIconPath": "images/tabbarIcon/info1.png"
    },{
      "pagePath": "pages/user/user",
      "text": "用户",
      "iconPath": "images/tabbarIcon/user2.png",
      "selectedIconPath": "images/tabbarIcon/user1.png"
    }]
  },
  "usingComponents": {},
  "style": "v2",
  "sitemapLocation": "sitemap.json"
}

```

### 获取页面高度

```js
(wx.getSystemInfoSync().windowHeight * 2 - 200)
```

### 微信小程序登入授权

```js
<button class="loginBtn" open-type="getUserInfo" bindgetuserinfo="getUserInfo" >一键登入</button>
```

小程序登入

```js
https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/userProfile.html
```

### 微信支付流程

1. 创建订单(请求创建订单的api接口，订单金额、收货地址、订单包含的商品信息)
2. 订单预支付(请求订单预支付的API接口，把订单编号发给服务器)
3. 支付微信订单(发起微信支付 wx.requestPayment)
